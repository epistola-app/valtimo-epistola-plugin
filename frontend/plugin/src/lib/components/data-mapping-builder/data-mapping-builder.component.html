<div class="data-mapping-builder" *ngIf="{
  disabled: disabled$ | async,
  templateFields: templateFields$ | async,
  templateFieldOptions: templateFieldOptions$ | async
} as obs">
  <div class="mapping-header">
    <h5>{{ 'dataMappingTitle' | pluginTranslate: pluginId | async }}</h5>
    <p class="helper-text">{{ 'dataMappingDescription' | pluginTranslate: pluginId | async }}</p>
  </div>

  <div class="mapping-table" *ngIf="mappings.length > 0">
    <div class="mapping-row mapping-header-row">
      <div class="mapping-cell template-field-cell">
        {{ 'templateField' | pluginTranslate: pluginId | async }}
      </div>
      <div class="mapping-cell data-source-cell">
        {{ 'dataSource' | pluginTranslate: pluginId | async }}
      </div>
      <div class="mapping-cell actions-cell"></div>
    </div>

    <div class="mapping-row" *ngFor="let mapping of mappings; let i = index; trackBy: trackByMapping">
      <div class="mapping-cell template-field-cell">
        <v-select
          [name]="'templateField_' + i"
          [items]="obs.templateFieldOptions"
          [defaultSelectionId]="mapping.templateField"
          [disabled]="obs.disabled"
          [required]="true"
          (selectedChange)="onTemplateFieldChange(i, $event)"
        ></v-select>
      </div>

      <div class="mapping-cell data-source-cell">
        <div class="data-source-input">
          <v-select
            [name]="'prefix_' + i"
            [items]="prefixOptions"
            [defaultSelectionId]="mapping.prefix"
            [disabled]="obs.disabled"
            (selectedChange)="onPrefixChange(i, $event)"
            class="prefix-select"
          ></v-select>
          <v-input
            [name]="'path_' + i"
            [defaultValue]="mapping.path"
            [disabled]="obs.disabled"
            [required]="true"
            (valueChange)="onPathChange(i, $event)"
            class="path-input"
            [placeholder]="'e.g. customer.name'"
          ></v-input>
        </div>
      </div>

      <div class="mapping-cell actions-cell">
        <button
          type="button"
          class="btn btn-sm btn-outline-danger"
          [disabled]="obs.disabled"
          (click)="removeMapping(i)"
          title="Remove mapping"
        >
          <span class="mdi mdi-delete"></span>
        </button>
      </div>
    </div>
  </div>

  <div class="no-mappings" *ngIf="mappings.length === 0">
    <p>{{ 'noMappings' | pluginTranslate: pluginId | async }}</p>
  </div>

  <div class="mapping-actions">
    <button
      type="button"
      class="btn btn-sm btn-outline-primary"
      [disabled]="obs.disabled"
      (click)="addMapping()"
    >
      <span class="mdi mdi-plus"></span>
      {{ 'addMapping' | pluginTranslate: pluginId | async }}
    </button>
  </div>
</div>
